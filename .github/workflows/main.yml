name: CI

on:
  push:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Install ngrok
        run: |
          # Download the latest ngrok version
          wget https://bin.equinox.io/c/111111/ngrok-stable-linux-amd64.zip -O ngrok.zip
          # Unzip ngrok
          unzip ngrok.zip -d /usr/local/bin
          # Clean up the zip file
          rm ngrok.zip

      - name: Authenticate ngrok
        run: |
          # Authenticate ngrok with the provided token
          ngrok authtoken ${{ secrets.NGROK_AUTH_TOKEN }}

      - name: Start ngrok Tunnel
        run: |
          # Create an ngrok TCP tunnel to port 22 (SSH)
          nohup ngrok tcp 22 &

      - name: Enable SSH (if not already enabled)
        run: |
          # Ensure SSH is installed and running
          sudo apt-get update
          sudo apt-get install -y openssh-server
          sudo systemctl enable ssh
          sudo systemctl start ssh
